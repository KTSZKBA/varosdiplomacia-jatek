<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>Városdiplomácia játék – Településhálózatok mint erőforrások</title>
  <style>
    :root {
      --bg: #f5f7fb;
      --card-bg: #ffffff;
      --border: #dde1ee;
      --accent: #2b6cb0;
      --accent-soft: #ebf4ff;
      --text-main: #1a202c;
      --text-soft: #4a5568;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 1100px;
      margin: 0 auto;
      padding: 24px 16px 40px;
      background: var(--bg);
      color: var(--text-main);
    }

    h1 {
      font-size: 1.8rem;
      margin-bottom: 0.3rem;
    }

    h2 {
      font-size: 1.3rem;
      margin-bottom: 0.4rem;
    }

    h3 {
      font-size: 1.05rem;
      margin-top: 1rem;
      margin-bottom: 0.4rem;
    }

    p {
      margin-top: 0.3rem;
      margin-bottom: 0.3rem;
    }

    .tagline {
      color: var(--text-soft);
      margin-bottom: 1rem;
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2fr);
      gap: 16px;
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    .section {
      background: var(--card-bg);
      border-radius: 12px;
      border: 1px solid var(--border);
      padding: 16px 18px;
      margin-bottom: 16px;
      box-shadow: 0 4px 14px rgba(15, 23, 42, 0.06);
    }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 8px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: var(--accent-soft);
      color: var(--accent);
      border-radius: 999px;
      padding: 2px 10px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
      gap: 8px;
      margin-top: 4px;
    }

    label {
      display: block;
      font-size: 0.9rem;
      color: var(--text-soft);
    }

    input[type="text"] {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid var(--border);
      margin-top: 4px;
      font-size: 0.9rem;
    }

    input[type="checkbox"] {
      transform: translateY(1px);
    }

    .checkbox-label {
      display: flex;
      align-items: flex-start;
      gap: 6px;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
      background: #f9fafb;
      cursor: pointer;
      font-size: 0.88rem;
    }

    .checkbox-label:hover {
      background: #edf2f7;
    }

    .hint {
      font-size: 0.8rem;
      color: var(--text-soft);
      margin-bottom: 6px;
    }

    button {
      padding: 8px 14px;
      border-radius: 999px;
      border: none;
      font-size: 0.88rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    button.primary {
      background: var(--accent);
      color: white;
    }

    button.secondary {
      background: #e2e8f0;
      color: #111827;
    }

    button + button {
      margin-left: 8px;
    }

    #message {
      color: #c53030;
      font-size: 0.85rem;
      margin-top: 6px;
    }

    .municipality-list {
      margin-top: 8px;
      max-height: 280px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .municipality-card {
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 8px 10px;
      margin-bottom: 8px;
      background: #f9fafb;
      font-size: 0.85rem;
    }

    .municipality-card strong {
      font-size: 0.9rem;
    }

    .soft-label {
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .matches-container .municipality-card {
      background: #ffffff;
    }

    .cluster-card {
      border-radius: 12px;
      padding: 10px 12px;
      margin-bottom: 8px;
      font-size: 0.85rem;
      border: 1px solid var(--border);
      background: #fdfdfd;
    }

    .cluster-header {
      font-weight: 600;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .cluster-tag {
      font-size: 0.75rem;
      padding: 1px 8px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.04);
    }

    .pill {
      display: inline-flex;
      align-items: center;
      padding: 3px 8px;
      border-radius: 999px;
      background: #edf2f7;
      font-size: 0.75rem;
      margin: 2px 4px 2px 0;
    }

    canvas {
      margin-top: 8px;
      border-radius: 10px;
      background: #ffffff;
      border: 1px solid var(--border);
    }
  </style>
</head>
<body>

  <header style="margin-bottom: 18px;">
    <h1>Városdiplomácia játék</h1>
    <div class="tagline">
      <strong>Településhálózatok, mint erőforrások</strong> – közös tematikus célok és jó gyakorlatok alapján
      kialakuló együttműködési klaszterek.
    </div>
  </header>

  <div class="layout">
    <!-- Bal oldal: bevitel + lista -->
    <div>
      <div class="section">
        <div class="section-header">
          <h2>1. Település/profil megadása</h2>
          <span class="badge">Workshop input</span>
        </div>
        <p class="hint">
          Minden asztal egy települést (valós vagy fiktív) képvisel. Adjátok meg a nevet,
          majd jelöljétek, <b>milyen témákban keresnétek együttműködést</b>, és
          <b>miben van már átadható jó gyakorlatotok</b>.
        </p>

        <label>
          Település neve (vagy kódnév):
          <input type="text" id="nameInput" placeholder="Pl. Kisváros A, Határmenti település 1, stb.">
        </label>

        <h3>A) Tematikus együttműködési célok (max. 3)</h3>
        <p class="hint">Mely területeken keresnétek partnereket, támogatást, tudásmegosztást?</p>
        <div class="grid" id="challengesContainer"></div>

        <h3>B) Erősségek / átadható jó gyakorlatok (max. 3)</h3>
        <p class="hint">Mely területeken vagytok előrébb, ahol szívesen megosztanátok tapasztalatot?</p>
        <div class="grid" id="strengthsContainer"></div>

        <button id="addBtn" class="primary">Település hozzáadása</button>
        <span id="message"></span>
      </div>

      <div class="section">
        <div class="section-header">
          <h2>2. Eddig megadott települések</h2>
          <span class="badge">Összesítés</span>
        </div>
        <div id="municipalityList" class="municipality-list"></div>
      </div>
    </div>

    <!-- Jobb oldal: párosítás, klaszter, grafikon -->
    <div>
      <div class="section">
        <div class="section-header">
          <h2>3. Párosítások és klaszterek</h2>
          <span class="badge">Hálózatkép</span>
        </div>
        <p class="hint">
          A gombra kattintva:
          <ul class="hint" style="padding-left:18px; margin-top:4px;">
            <li>minden településhez megjelennek a hasonló célú „peerek” és a lehetséges „mentorok”,</li>
            <li>létrejönnek tematikus klaszterek (közös célterületek mentén),</li>
            <li>frissül az alábbi tematikus cél-statisztika grafikon.</li>
          </ul>
        </p>
        <button id="matchBtn" class="primary">Párosítások és klaszterek frissítése</button>
        <button id="exportBtn" class="secondary">CSV export (kutatáshoz)</button>
      </div>

      <div class="section">
        <h3>3/a. Településenkénti kapcsolatok</h3>
        <div id="matches" class="matches-container"></div>
      </div>

      <div class="section">
        <h3>3/b. Klaszterek (közös tematikus célok mentén)</h3>
        <p class="hint">Az azonos klaszterben lévő települések legalább egy közös tematikus célt jelöltek meg.</p>
        <div id="clusterContainer"></div>
      </div>

      <div class="section">
        <h3>3/c. Tematikus célok gyakorisága (mini grafikon)</h3>
        <p class="hint">Hány település jelölte az egyes célterületeket? – gyors hőmérő a teremben.</p>
        <canvas id="challengeChart" width="480" height="260"></canvas>
      </div>
    </div>
  </div>

<script>
  // --- Tematikus együttműködési célok ---
  // Ezek felelnek meg a kérdőíved "milyen célokat szeretnének elérni hálózatokon keresztül"
  // típusú kérdéseinek.
  const thematicGoals = [
    "Zöld átmenet, klíma- és környezetpolitika",
    "Energiamegtakarítás, épületfelújítás, energiaszegénység",
    "Fenntartható közlekedés és mobilitás",
    "Lakhatás, szociális városrehabilitáció",
    "Helyi gazdaság- és vállalkozásfejlesztés",
    "Turizmusfejlesztés, desztinációmenedzsment",
    "Kulturális szféra és kreatív város",
    "Ifjúságpolitika, oktatás, tehetséggondozás",
    "Digitális átállás, okosváros-megoldások",
    "Társadalmi bevonás, részvételi tervezés",
    "Szociális ellátás, sérülékeny csoportok támogatása",
    "Válságkezelés, katasztrófavédelem, reziliencia"
  ];

  // Erősségekhez ugyanazt a listát használjuk:
  // itt azt jelölik, ahol már van jó gyakorlat.
  const goalsForStrengths = thematicGoals.slice();

  const municipalities = [];

  // --- UI generálás: checkboxok ---
  function renderOptions(containerId, options, prefix) {
    const container = document.getElementById(containerId);
    options.forEach((opt, index) => {
      const id = `${prefix}_${index}`;
      const wrapper = document.createElement("div");
      const label = document.createElement("label");
      label.className = "checkbox-label";

      const input = document.createElement("input");
      input.type = "checkbox";
      input.id = id;
      input.value = opt;

      const textSpan = document.createElement("span");
      textSpan.textContent = opt;

      label.appendChild(input);
      label.appendChild(textSpan);
      wrapper.appendChild(label);
      container.appendChild(wrapper);
    });
  }

  function getCheckedValues(prefix) {
    const inputs = document.querySelectorAll(`input[id^='${prefix}_']`);
    const selected = [];
    inputs.forEach(i => { if (i.checked) selected.push(i.value); });
    return selected;
  }

  function clearSelections(prefix) {
    const inputs = document.querySelectorAll(`input[id^='${prefix}_']`);
    inputs.forEach(i => { i.checked = false; });
  }

  // --- Településlista renderelése ---
  function renderMunicipalityList() {
    const container = document.getElementById("municipalityList");
    container.innerHTML = "";
    if (!municipalities.length) {
      container.textContent = "Még nincs hozzáadott település.";
      return;
    }
    municipalities.forEach((m, idx) => {
      const card = document.createElement("div");
      card.className = "municipality-card";
      card.innerHTML = `
        <strong>${idx + 1}. ${m.name}</strong><br>
        <div class="soft-label"><b>Tematikus célok (ahol partnert kerestek):</b> ${m.challenges.join(", ") || "–"}</div>
        <div class="soft-label"><b>Erősségek / jó gyakorlatok:</b> ${m.strengths.join(", ") || "–"}</div>
      `;
      container.appendChild(card);
    });
  }

  // --- Párosítások (peerek + mentorok) ---
  function generateMatches() {
    const container = document.getElementById("matches");
    container.innerHTML = "";
    if (municipalities.length < 2) {
      container.textContent = "Legalább két település szükséges a párosításhoz.";
      return;
    }

    municipalities.forEach((m, idx) => {
      const peers = [];
      const mentors = new Set();

      municipalities.forEach((other, j) => {
        if (idx === j) return;
        // hasonló célok
        const commonGoals = m.challenges.filter(c => other.challenges.includes(c));
        if (commonGoals.length > 0) {
          peers.push(`${other.name}`);
        }
        // mentorok: más erős abban a tematikában, ami nekem cél/fejlesztendő terület
        m.challenges.forEach(ch => {
          if (other.strengths.includes(ch)) {
            mentors.add(other.name);
          }
        });
      });

      const div = document.createElement("div");
      div.className = "municipality-card";
      div.innerHTML = `
        <strong>${m.name}</strong><br>
        <div class="soft-label"><b>Hasonló tematikus célokkal rendelkező „peerek”:</b> ${peers.length ? peers.join(", ") : "nincs egyértelműen hasonló profil"}</div>
        <div class="soft-label"><b>Potenciális „mentorok” (ahol már van jó gyakorlat a ti célterületeiteken):</b> ${mentors.size ? Array.from(mentors).join(", ") : "jelenleg nincs egyértelmű mentor"}</div>
      `;
      container.appendChild(div);
    });
  }

  // --- Klaszterek generálása (közös tematikus célok alapján) ---
  function generateClusters() {
    const container = document.getElementById("clusterContainer");
    container.innerHTML = "";

    const n = municipalities.length;
    if (n < 2) {
      container.textContent = "Legalább két település szükséges a klaszterekhez.";
      return;
    }

    // Szomszédsági lista: él, ha van közös cél
    const adj = Array.from({ length: n }, () => []);
    for (let i = 0; i < n; i++) {
      for (let j = i + 1; j < n; j++) {
        const common = municipalities[i].challenges.filter(c => municipalities[j].challenges.includes(c));
        if (common.length > 0) {
          adj[i].push(j);
          adj[j].push(i);
        }
      }
    }

    const visited = new Array(n).fill(false);
    const clusters = [];

    for (let i = 0; i < n; i++) {
      if (!visited[i]) {
        const queue = [i];
        visited[i] = true;
        const component = [i];
        while (queue.length) {
          const v = queue.shift();
          adj[v].forEach(u => {
            if (!visited[u]) {
              visited[u] = true;
              queue.push(u);
              component.push(u);
            }
          });
        }
        clusters.push(component);
      }
    }

    // Klaszterek kirajzolása
    clusters.forEach((comp, idx) => {
      const div = document.createElement("div");
      div.className = "cluster-card";

      const hue = (idx * 70) % 360;
      div.style.borderColor = `hsl(${hue}, 60%, 65%)`;
      div.style.background = `linear-gradient(90deg, hsla(${hue}, 80%, 95%, 0.9), #ffffff)`;

      // Gyakoribb célok a klaszteren belül
      const goalCount = {};
      comp.forEach(i => {
        municipalities[i].challenges.forEach(ch => {
          goalCount[ch] = (goalCount[ch] || 0) + 1;
        });
      });
      const commonGoals = Object.entries(goalCount)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 3)
        .map(([ch, count]) => `${ch} (${count})`);

      const names = comp.map(i => municipalities[i].name);

      const header = document.createElement("div");
      header.className = "cluster-header";
      header.innerHTML = `
        <span>Klaszter ${idx + 1}</span>
        <span class="cluster-tag">${names.length} település</span>
      `;
      div.appendChild(header);

      const namesRow = document.createElement("div");
      namesRow.style.marginBottom = "4px";
      namesRow.innerHTML = `<span class="soft-label"><b>Települések:</b></span> `;
      names.forEach(nm => {
        const pill = document.createElement("span");
        pill.className = "pill";
        pill.textContent = nm;
        namesRow.appendChild(pill);
      });

      const goalsRow = document.createElement("div");
      goalsRow.innerHTML = `<span class="soft-label"><b>Jellemző tematikus célok:</b> ${commonGoals.length ? commonGoals.join(", ") : "–"}</span>`;

      div.appendChild(namesRow);
      div.appendChild(goalsRow);

      container.appendChild(div);
    });
  }

  // --- Tematikus cél-statisztika: egyszerű oszlopdiagram canvas-szal ---
  function renderChallengeChart() {
    const canvas = document.getElementById("challengeChart");
    const ctx = canvas.getContext("2d");
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    if (!municipalities.length) {
      ctx.fillStyle = "#4a5568";
      ctx.font = "12px system-ui";
      ctx.fillText("A grafikon megjelenítéséhez adj hozzá legalább egy települést.", 16, 40);
      return;
    }

    const counts = thematicGoals.map(goal =>
      municipalities.filter(m => m.challenges.includes(goal)).length
    );

    const maxCount = Math.max(...counts, 1);

    const paddingLeft = 150;
    const paddingRight = 20;
    const paddingTop = 20;
    const paddingBottom = 20;
    const barHeight = 16;
    const barGap = 6;

    const chartWidth = canvas.width - paddingLeft - paddingRight;

    ctx.font = "11px system-ui";
    ctx.textBaseline = "middle";

    counts.forEach((count, idx) => {
      const y = paddingTop + idx * (barHeight + barGap) + barHeight / 2;

      ctx.fillStyle = "#4a5568";
      const label = thematicGoals[idx].length > 35
        ? thematicGoals[idx].slice(0, 34) + "…"
        : thematicGoals[idx];
      ctx.fillText(label, 6, y);

      const width = (count / maxCount) * chartWidth;

      ctx.fillStyle = "#e2e8f0";
      ctx.fillRect(paddingLeft, y - barHeight / 2, chartWidth, barHeight);

      ctx.fillStyle = "#2b6cb0";
      ctx.fillRect(paddingLeft, y - barHeight / 2, width, barHeight);

      ctx.fillStyle = "#1a202c";
      ctx.fillText(count.toString(), paddingLeft + width + 4, y);
    });
  }

  // --- CSV export ---
  function exportCSV() {
    if (!municipalities.length) {
      alert("Nincs adat az exporthoz.");
      return;
    }
    let csv = "name;goals(keresett_teruletek);strengths(jo_gyakorlatok)\n";
    municipalities.forEach(m => {
      const line = [
        `"${m.name.replace(/"/g, '""')}"`,
        `"${m.challenges.join(", ").replace(/"/g, '""')}"`,
        `"${m.strengths.join(", ").replace(/"/g, '""')}"`
      ].join(";");
      csv += line + "\n";
    });
    const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "varosdiplomacia_jatek_tematikus_celok.csv";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  }

  // --- Inicializálás ---
  renderOptions("challengesContainer", thematicGoals, "ch");
  renderOptions("strengthsContainer", goalsForStrengths, "st");
  renderMunicipalityList();
  renderChallengeChart();

  document.getElementById("addBtn").addEventListener("click", () => {
    const msg = document.getElementById("message");
    msg.textContent = "";

    const name = document.getElementById("nameInput").value.trim();
    if (!name) {
      msg.textContent = "Kérlek, adj meg egy településnevet!";
      return;
    }

    const selectedChallenges = getCheckedValues("ch");
    const selectedStrengths = getCheckedValues("st");

    if (selectedChallenges.length === 0) {
      msg.textContent = "Legalább egy tematikus célt válasszatok ki!";
      return;
    }
    if (selectedChallenges.length > 3) {
      msg.textContent = "Maximum 3 tematikus célt választhattok ki.";
      return;
    }
    if (selectedStrengths.length === 0) {
      msg.textContent = "Legalább egy erősséget válasszatok ki!";
      return;
    }
    if (selectedStrengths.length > 3) {
      msg.textContent = "Maximum 3 erősséget választhattok ki.";
      return;
    }

    municipalities.push({
      name,
      challenges: selectedChallenges,
      strengths: selectedStrengths
    });

    document.getElementById("nameInput").value = "";
    clearSelections("ch");
    clearSelections("st");
    renderMunicipalityList();
    renderChallengeChart();
  });

  document.getElementById("matchBtn").addEventListener("click", () => {
    generateMatches();
    generateClusters();
    renderChallengeChart();
  });

  document.getElementById("exportBtn").addEventListener("click", exportCSV);
</script>

</body>
</html>
